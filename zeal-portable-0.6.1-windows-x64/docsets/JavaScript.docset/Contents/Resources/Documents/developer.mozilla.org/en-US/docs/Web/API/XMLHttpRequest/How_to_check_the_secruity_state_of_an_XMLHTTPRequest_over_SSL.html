<html><!-- Mirrored from developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/How_to_check_the_secruity_state_of_an_XMLHTTPRequest_over_SSL by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 31 Jan 2022 17:49:52 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="../../../../../favicon-48x48.97046865.png"><link rel="apple-touch-icon" href="../../../../../apple-touch-icon.0ea0fa02.png"><meta name="theme-color" content="#ffffff"><link rel="manifest" href="https://developer.mozilla.org/manifest.56b1cedc.json"><link rel="search" type="application/opensearchdescription+xml" href="https://developer.mozilla.org/opensearch.xml" title="MDN Web Docs"><script>Array.prototype.flat&&Array.prototype.includes||document.write('<script src="../../../../../../polyfill.io/v3/polyfill.min3a72.js?features=Array.prototype.flat%2Ces6"><\/script>')</script><title>How to check the security state of an XMLHTTPRequest over SSL</title><link rel="preload" as="font" type="font/woff2" crossorigin="" href="../../../../../static/media/ZillaSlab-Bold.subset.0beac26b.woff2"><meta name="description" content="Here is a an example Javascript function that prints the security details of an XMLHTTPRequest sent over SSL. The function is passed the channel property of an XMLHTTPRequest to extract the following information:"><meta property="og:url" content="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/How_to_check_the_secruity_state_of_an_XMLHTTPRequest_over_SSL"><meta property="og:title" content="How to check the security state of an XMLHTTPRequest over SSL - Web APIs | MDN"><meta property="og:description" content="Here is a an example Javascript function that prints the security details of an XMLHTTPRequest sent over SSL. The function is passed the channel property of an XMLHTTPRequest to extract the following information:"><meta property="og:locale" content="en-US"><meta property="og:image" content="https://developer.mozilla.org/mdn-social-share.0ca9dbda.png"><meta property="twitter:card" content="summary_large_image"><meta name="robots" content="index, follow"><link rel="canonical" href="How_to_check_the_secruity_state_of_an_XMLHTTPRequest_over_SSL.html"><style media="print">.breadcrumbs-container,.document-toc-container,.language-menu,.language-toggle,.on-github,.page-footer,.page-header-main,nav.sidebar,ul.prev-next{display:none!important}.main-page-content,.main-page-content pre{padding:2px}.main-page-content pre{border-left-width:2px}</style><link href="../../../../../static/css/main.55b68e13.chunk.css" rel="stylesheet"><script>LUX=(function(){var a=("undefined"!==typeof(LUX)&&"undefined"!==typeof(LUX.gaMarks)?LUX.gaMarks:[]);var d=("undefined"!==typeof(LUX)&&"undefined"!==typeof(LUX.gaMeasures)?LUX.gaMeasures:[]);var j="LUX_start";var k=window.performance;var l=("undefined"!==typeof(LUX)&&LUX.ns?LUX.ns:(Date.now?Date.now():+(new Date())));if(k&&k.timing&&k.timing.navigationStart){l=k.timing.navigationStart}function f(){if(k&&k.now){return k.now()}var o=Date.now?Date.now():+(new Date());return o-l}function b(n){if(k){if(k.mark){return k.mark(n)}else{if(k.webkitMark){return k.webkitMark(n)}}}a.push({name:n,entryType:"mark",startTime:f(),duration:0});return}function m(p,t,n){if("undefined"===typeof(t)&&h(j)){t=j}if(k){if(k.measure){if(t){if(n){return k.measure(p,t,n)}else{return k.measure(p,t)}}else{return k.measure(p)}}else{if(k.webkitMeasure){return k.webkitMeasure(p,t,n)}}}var r=0,o=f();if(t){var s=h(t);if(s){r=s.startTime}else{if(k&&k.timing&&k.timing[t]){r=k.timing[t]-k.timing.navigationStart}else{return}}}if(n){var q=h(n);if(q){o=q.startTime}else{if(k&&k.timing&&k.timing[n]){o=k.timing[n]-k.timing.navigationStart}else{return}}}d.push({name:p,entryType:"measure",startTime:r,duration:(o-r)});return}function h(n){return c(n,g())}function c(p,o){for(i=o.length-1;i>=0;i--){var n=o[i];if(p===n.name){return n}}return undefined}function g(){if(k){if(k.getEntriesByType){return k.getEntriesByType("mark")}else{if(k.webkitGetEntriesByType){return k.webkitGetEntriesByType("mark")}}}return a}return{mark:b,measure:m,gaMarks:a,gaMeasures:d}})();LUX.ns=(Date.now?Date.now():+(new Date()));LUX.ac=[];LUX.cmd=function(a){LUX.ac.push(a)};LUX.init=function(){LUX.cmd(["init"])};LUX.send=function(){LUX.cmd(["send"])};LUX.addData=function(a,b){LUX.cmd(["addData",a,b])};LUX_ae=[];window.addEventListener("error",function(a){LUX_ae.push(a)});LUX_al=[];if("function"===typeof(PerformanceObserver)&&"function"===typeof(PerformanceLongTaskTiming)){var LongTaskObserver=new PerformanceObserver(function(c){var b=c.getEntries();for(var a=0;a<b.length;a++){var d=b[a];LUX_al.push(d)}});try{LongTaskObserver.observe({type:["longtask"]})}catch(e){}};</script><script src="../../../../../../cdn.speedcurve.com/js/lux2ff4.js?id=108906238" async="" defer="" crossorigin="anonymous"></script><script defer="" src="../../../../../static/js/ga.js"></script><script src="../../../../../static/js/runtime-main.742e058d.js" defer=""></script><script src="../../../../../static/js/4.a756dea3.chunk.js" defer=""></script><script src="../../../../../static/js/main.e0441009.chunk.js" defer=""></script></head><body><div id="root"><ul id="nav-access" class="a11y-nav"><li><a id="skip-main" href="#content">Skip to main content</a></li><li><a id="skip-search" href="#main-q">Skip to search</a></li><li><a id="skip-select-language" href="#select-language">Skip to select language</a></li></ul><div class="page-wrapper document-page"><header class="page-header"><a href="https://developer.mozilla.org/en-US/" class="logo" aria-label="MDN Web Docs"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451.74 135"><path d="M7.14 8.35v111.06h111.05V8.35zm103.71 56c-.48.92-1 1.79-1.46 2.71a3.44 3.44 0 01-3.54 2 2.4 2.4 0 00-1.55.5c-1.37.9-2.76 1.79-4.18 2.63a7.33 7.33 0 01-6.35.34 29.71 29.71 0 00-10.63-2 11.7 11.7 0 00-9.46 4.31 14.84 14.84 0 00-2.13 4.29c-1.24 3.07-2.3 21.38-2.3 26.05 0 0-17.62-3.42-34.15-20.34l4.31-11.32h-13.5l9.76-10.35h-16.8l9.77-10.34H12.69L30.45 34a40.9 40.9 0 0119.77-10.83c7.1-1.22 8.93-.53 13.31.77l2.43.73.85.25 3.1.95a12.56 12.56 0 006.21.09 11.37 11.37 0 018.25 1 8.24 8.24 0 014.1 6.22 7.29 7.29 0 003.61 5.49 59.45 59.45 0 009.32 4.11c2.27.86 4.54 1.84 6.79 2.72a6.81 6.81 0 012.86 2.06 4.81 4.81 0 011.1 2.73c.14 2 .37 4 .47 6a15.24 15.24 0 01-1.77 8.03zM320.12 39.62a5.42 5.42 0 00-4.53 2.13 7.36 7.36 0 00-1.7 4.43v2.36a6.28 6.28 0 001.7 4.46 5.63 5.63 0 004.3 1.82 5.12 5.12 0 004.57-2.27A9.7 9.7 0 00326 47a8.11 8.11 0 00-1.67-5.52 5.36 5.36 0 00-4.21-1.86zM387.38 39.53a5.52 5.52 0 00-4.7 2.15 8.8 8.8 0 00-1.63 5.49 9.23 9.23 0 001.58 5.45 5.38 5.38 0 004.7 2.25 5.61 5.61 0 004.74-2.2 8.91 8.91 0 001.68-5.59 8.24 8.24 0 00-1.75-5.52 5.76 5.76 0 00-4.62-2.03zM299.47 41.35a4.34 4.34 0 00-4-1.92 4.55 4.55 0 00-3.89 1.73 8.37 8.37 0 00-1.58 4.17h10.48a6.3 6.3 0 00-1.01-3.98zM357.74 30.75H352v23.31h5.72q5.47 0 8.35-3t2.93-8.65q0-5.43-2.88-8.55t-8.38-3.11z"></path><path d="M121.55 8.35v70.8h323V8.35zm42.21 22.45h-4V54h3.68v3.73h-11.25V54h3.31V36.79h-.19l-9.63 19.12h-2.12l-10-19.4h-.19V54h3.45v3.73h-11.15V54h3.68V30.8h-4v-3.73H133l11.66 22.56h.19l11.18-22.56h7.7zm29.12 22.67q-4.11 4.28-11.38 4.28h-14.06v-3.69h3.73V30.75h-3.73v-3.68h13.83q7.59 0 11.66 4.29a15.4 15.4 0 014 11 15.33 15.33 0 01-4.05 11.11zm38.89-22.67h-3.68v27h-2.6L208.08 35h-.19v19h4.67v3.73h-12.22V54h3.49V30.8h-4v-3.73h7.08l16.9 22.09h.19V30.8h-4.58v-3.73h12.32zm43.8 27h-3.31l-7.83-23.18h-.19l-7.55 23.18h-3.35l-8.78-27h-2.65v-3.73H253v3.73h-3.87L255 50.71h.23l6.61-19.91H259v-3.73h11v3.73h-2.78l6.61 20.1h.23l5.43-20.1h-4.15v-3.73h11v3.73h-2.54zm26.71-1.51a9.66 9.66 0 01-6.42 2 10.2 10.2 0 01-7.41-2.74c-1.89-1.82-2.83-4.47-2.83-7.93a12.37 12.37 0 012.64-8.12 9 9 0 017.32-3.21 8.62 8.62 0 016.75 2.69 9.65 9.65 0 012.45 6.52 13.67 13.67 0 01-.28 2.69H290q.29 6.71 6.18 6.7a5.2 5.2 0 003.71-1.18 5.82 5.82 0 001.67-2.83l3.45.71a7.21 7.21 0 01-2.73 4.65zm25.77-1.63c-1.51 2.4-3.92 3.61-7.22 3.61s-5.84-1.29-7.22-3.87c0 .25-.1.82-.21 1.7s-.19 1.44-.22 1.7H309c.16-1 .31-2 .47-3.07a21.42 21.42 0 00.24-3.16v-23h-3.4v-3.3h7.55V40.9a9.76 9.76 0 012.67-3.28 7.33 7.33 0 014.74-1.4 8.48 8.48 0 016.5 2.78q2.55 2.74 2.55 7.74a14.6 14.6 0 01-2.27 7.87zm41.39-1.14q-4.11 4.28-11.37 4.28H344v-3.74h3.73V30.75H344v-3.68h13.83q7.59 0 11.66 4.29a15.41 15.41 0 014.06 11 15.34 15.34 0 01-4.11 11.11zm25.65 1.68a10.53 10.53 0 01-7.9 3.07 10 10 0 01-7.63-3 10.93 10.93 0 01-2.8-7.83 12.13 12.13 0 012.69-7.93q2.69-3.3 8-3.3t8 3.28a12 12 0 012.64 7.76 10.86 10.86 0 01-3 7.9zm22.61.57c-1.4 1.66-3.63 2.5-6.68 2.5a9.58 9.58 0 01-7.15-2.76q-2.72-2.76-2.71-7.91a12.25 12.25 0 012.69-8 9.17 9.17 0 017.5-3.28 15 15 0 013.82.48 10.37 10.37 0 013.5 1.65l.85 5.47-3.35.38-.76-3.54a8.07 8.07 0 00-4.11-1 4.9 4.9 0 00-4.39 2.15 9.93 9.93 0 00-1.41 5.55 8.9 8.9 0 001.5 5.38 5.23 5.23 0 004.44 2c2.92 0 4.67-1.7 5.23-5.1l3.5.71a10.34 10.34 0 01-2.47 5.27zm20.48.75a11.68 11.68 0 01-6.63 1.75 15.52 15.52 0 01-8.26-2.08L424 51l3.26.33-.1 2.74a7 7 0 002.06.66 12.63 12.63 0 002.19.19 8.68 8.68 0 003.66-.75 2.5 2.5 0 001.63-2.36 2.25 2.25 0 00-1.32-2.2 12.65 12.65 0 00-3.28-1 47.39 47.39 0 01-3.9-.82 7.5 7.5 0 01-3.25-1.7 4.67 4.67 0 01-1.33-3.66c0-2.36.88-4 2.62-4.91a12 12 0 015.6-1.37 15 15 0 014.08.55 16.65 16.65 0 013.47 1.39l.47 5.1-3.3.37-.48-3.3a9.5 9.5 0 00-4.06-.9 5.62 5.62 0 00-2.87.66 2.33 2.33 0 00-1.15 2.25 2.13 2.13 0 001.3 2.07 11.91 11.91 0 003.21.92 36.69 36.69 0 013.82.83 7.46 7.46 0 013.21 1.74 4.9 4.9 0 011.3 3.73 5.56 5.56 0 01-2.66 4.91z"></path><path d="M181.17 30.75h-5.71v23.31h5.71q5.47 0 8.36-3t2.88-8.61q0-5.43-2.88-8.55t-8.36-3.15zM121.63 119.32V81.74h114.91v37.58zM153.22 109h-2v-6.85a4.8 4.8 0 00-1.58-4 5.57 5.57 0 00-3.55-1.26 5 5 0 00-4.92 3.26 4.19 4.19 0 00-1.88-2.46 5.82 5.82 0 00-3-.8 4.89 4.89 0 00-4.56 2.56v-2.21h-6.28v3.26h2v8.5h-2v3.23h9.11V109h-2.86v-5.25a4.4 4.4 0 01.69-2.56 2.47 2.47 0 012.21-1q2.57 0 2.56 3.63v8.41h6.29V109h-2v-5.25a4.47 4.47 0 01.67-2.56 2.42 2.42 0 012.19-1q2.63 0 2.63 3.63v8.41h6.28zm9.88-12.07q-4 0-6 2.36a8.41 8.41 0 00-2 5.66 7.25 7.25 0 002.17 5.62 8 8 0 005.65 2 8.54 8.54 0 005.94-2.11 7.27 7.27 0 002.34-5.67 8.21 8.21 0 00-2-5.51q-2.07-2.34-6.1-2.34zm-.1 12.35a3 3 0 01-2.63-1.33 5.68 5.68 0 01-.9-3.26 5 5 0 011-3.28 3.23 3.23 0 012.61-1.18 3.5 3.5 0 012.59 1.08 4.56 4.56 0 011.07 3.31 5.21 5.21 0 01-1 3.41 3.33 3.33 0 01-2.74 1.25zm25-2.3l-3.39-.29-.7 2.32H179l8.32-9.54-.32-2.23h-13.19l-.53 5.25 3.16.34.67-2.36h4.65l-8.25 9.53.44 2.26h13.13zm7.62-9.74h-4.46v5.39h4.46zm0 9.61h-4.46v5.39h4.46zm13.54-17.49h-4.23l-6.48 22.88h4.22zm8.68 0h-4.23l-6.45 22.88h4.19zm15 22.51l-.07-2.26a1.22 1.22 0 01-.56.1c-.69 0-1-.39-1-1.16v-6.49a4.39 4.39 0 00-1.8-3.84 7 7 0 00-4.16-1.28 14.55 14.55 0 00-3.16.3 24.14 24.14 0 00-3.29 1.06l-.56 3.46 3.39.4.5-1.69a2.78 2.78 0 011.08-.37 11.3 11.3 0 011.25-.07c1.19 0 1.89.37 2.09 1.1a8.55 8.55 0 01.3 2.26v.5a8.91 8.91 0 00-1.18-.11h-1.21a12.64 12.64 0 00-4.81.88 3.53 3.53 0 00-2.18 3.64 3.66 3.66 0 001.48 3.33 5.63 5.63 0 003.11 1 4.67 4.67 0 003-.91 6.78 6.78 0 001.8-2 3 3 0 003.33 3 5.54 5.54 0 002.66-.85zm-9.25-2.32a1.69 1.69 0 01-1.36-.52 1.81 1.81 0 01-.43-1.21 1.67 1.67 0 01.86-1.68 4.63 4.63 0 012-.42 7.69 7.69 0 011.07.07l1.06.13a3.58 3.58 0 01-1.08 2.74 3.24 3.24 0 01-2.11.89z"></path></svg></a><button type="button" class="ghost main-menu-toggle" aria-haspopup="true" aria-label="Show Menu"></button><div class="page-header-main "><nav class="main-nav" aria-label="Main menu"><ul class="main-menu nojs"><li class="top-level-entry-container"><button id="technologies-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Technologies</button><ul class="technologies " role="menu" aria-labelledby="technologies-button"><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Web" role="menuitem">Technologies Overview</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Web/HTML" role="menuitem">HTML</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Web/CSS" role="menuitem">CSS</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" role="menuitem">JavaScript</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Web/Guide/Graphics" role="menuitem">Graphics</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Web/HTTP" role="menuitem">HTTP</a></li><li role="none"><a tabindex="-1" href="../../API.html" role="menuitem">APIs</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions" role="menuitem">Browser Extensions</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Web/MathML" role="menuitem">MathML</a></li></ul></li><li class="top-level-entry-container"><button id="references-guides-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">References &amp; Guides</button><ul class="references-guides " role="menu" aria-labelledby="references-guides-button"><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Learn" role="menuitem">Learn web development</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Web/Tutorials" role="menuitem">Tutorials</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Web/Reference" role="menuitem">References</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Web/Guide" role="menuitem">Developer Guides</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Web/Accessibility" role="menuitem">Accessibility</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Games" role="menuitem">Game development</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/Web" role="menuitem">...more docs</a></li></ul></li><li class="top-level-entry-container"><button id="feedback-button" type="button" class="top-level-entry" aria-haspopup="menu" aria-expanded="false">Feedback</button><ul class="feedback " role="menu" aria-labelledby="feedback-button"><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/MDN/Contribute/Feedback" role="menuitem">Send Feedback</a></li><li role="none"><a tabindex="-1" href="https://developer.mozilla.org/en-US/docs/MDN/Contribute" role="menuitem">Contribute to MDN</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/content/issues/new" role="menuitem">Report a content issue<!-- --> 🌐</a></li><li role="none"><a tabindex="-1" target="_blank" rel="noopener noreferrer" href="https://github.com/mdn/yari/issues/new" role="menuitem">Report a platform issue<!-- --> 🌐</a></li></ul></li></ul></nav><div class="header-search"><form action="https://developer.mozilla.org/en-US/search" class="search-form search-widget" role="search"><label for="main-q" class="visually-hidden">Search MDN</label><input type="search" name="q" id="main-q" class="search-input-field" placeholder="Site search... (Press &quot;/&quot; to focus)" pattern="(.|\s)*\S(.|\s)*" required="" value=""><input type="submit" class="ghost search-button" value="" aria-label="Search"></form></div><div class="auth-container"></div></div></header><div class="breadcrumb-locale-container"><nav class="breadcrumbs-container" aria-label="Breadcrumb navigation"><ol typeof="BreadcrumbList" vocab="https://schema.org/" aria-label="breadcrumbs"><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="https://developer.mozilla.org/en-US/docs/Web"><span property="name">Web technology for developers</span></a><meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb" property="item" typeof="WebPage" href="../../API.html"><span property="name">Web APIs</span></a><meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-penultimate" property="item" typeof="WebPage" href="../XMLHttpRequest.html"><span property="name">XMLHttpRequest</span></a><meta property="position" content="3"></li><li property="itemListElement" typeof="ListItem"><a class="breadcrumb-current-page" property="item" typeof="WebPage" href="How_to_check_the_secruity_state_of_an_XMLHTTPRequest_over_SSL.html"><span property="name">How to check the security state of an XMLHTTPRequest over SSL</span></a><meta property="position" content="4"></li></ol></nav></div><main id="content" class="main-content" role="main"><article class="main-page-content" lang="en-US"><h1>How to check the security state of an XMLHTTPRequest over SSL</h1><div><p>Here is a an example Javascript function that prints the security details of an <a href="../XMLHttpRequest.html">XMLHTTPRequest</a> sent over SSL. The function is passed the channel property of an XMLHTTPRequest to extract the following information:</p>
<ul>
  <li>Was the connection secure?</li>
  <li>Was the used SSL certificate valid and what are its details (owner, expiration, certificate authority, etc.)?</li>
</ul>
<p>Notes:</p>
<ol>
  <li>This code requires elevated privileges to run; you can only call it from a browser extension or from a XULRunner application.</li>
  <li>The channel property becomes available only after the request is sent and the connection was established, that is, on readyState <code>LOADED</code>, <code>INTERACTIVE</code> or <code>COMPLETED</code>.</li>
  <li>By setting the mozBackgroundRequest property of the request object and modifying the example appropriately, you can create your own alert dialog to handle SSL exceptions in your Firefox extension or XULRunner application.</li>
</ol>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token comment">// Adapted from the patch for mozTCPSocket error reporting (bug 861196).</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>Cc<span class="token punctuation">,</span>Ci<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"chrome"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createTCPErrorFromFailedXHR</span><span class="token punctuation">(</span><span class="token parameter">xhr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> status <span class="token operator">=</span> xhr<span class="token punctuation">.</span>channel<span class="token punctuation">.</span><span class="token function">QueryInterface</span><span class="token punctuation">(</span>Ci<span class="token punctuation">.</span>nsIRequest<span class="token punctuation">)</span><span class="token punctuation">.</span>status<span class="token punctuation">;</span>

  <span class="token keyword">let</span> errType<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>status <span class="token operator">&amp;</span> <span class="token number">0xff0000</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0x5a0000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Security module</span>
    <span class="token keyword">const</span> nsINSSErrorsService <span class="token operator">=</span> Ci<span class="token punctuation">.</span>nsINSSErrorsService<span class="token punctuation">;</span>
    <span class="token keyword">let</span> nssErrorsService <span class="token operator">=</span> Cc<span class="token punctuation">[</span><span class="token string">'@mozilla.org/nss_errors_service;1'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span>nsINSSErrorsService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> errorClass<span class="token punctuation">;</span>

    <span class="token comment">// getErrorClass will throw a generic NS_ERROR_FAILURE if the error code is</span>
    <span class="token comment">// somehow not in the set of covered errors.</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      errorClass <span class="token operator">=</span> nssErrorsService<span class="token punctuation">.</span><span class="token function">getErrorClass</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//catching security protocol exception</span>
      errorClass <span class="token operator">=</span> <span class="token string">'SecurityProtocol'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>errorClass <span class="token operator">==</span> nsINSSErrorsService<span class="token punctuation">.</span><span class="token constant">ERROR_CLASS_BAD_CERT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      errType <span class="token operator">=</span> <span class="token string">'SecurityCertificate'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      errType <span class="token operator">=</span> <span class="token string">'SecurityProtocol'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// NSS_SEC errors (happen below the base value because of negative vals)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>status <span class="token operator">&amp;</span> <span class="token number">0xffff</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>nsINSSErrorsService<span class="token punctuation">.</span><span class="token constant">NSS_SEC_ERROR_BASE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// The bases are actually negative, so in our positive numeric space, we</span>
      <span class="token comment">// need to subtract the base off our value.</span>
      <span class="token keyword">let</span> nssErr <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>nsINSSErrorsService<span class="token punctuation">.</span><span class="token constant">NSS_SEC_ERROR_BASE</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>status <span class="token operator">&amp;</span> <span class="token number">0xffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">switch</span> <span class="token punctuation">(</span>nssErr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span> <span class="token comment">// SEC_ERROR_EXPIRED_CERTIFICATE, sec(11)</span>
          errName <span class="token operator">=</span> <span class="token string">'SecurityExpiredCertificateError'</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">12</span><span class="token operator">:</span> <span class="token comment">// SEC_ERROR_REVOKED_CERTIFICATE, sec(12)</span>
          errName <span class="token operator">=</span> <span class="token string">'SecurityRevokedCertificateError'</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token comment">// per bsmith, we will be unable to tell these errors apart very soon,</span>
        <span class="token comment">// so it makes sense to just folder them all together already.</span>
        <span class="token keyword">case</span> <span class="token number">13</span><span class="token operator">:</span> <span class="token comment">// SEC_ERROR_UNKNOWN_ISSUER, sec(13)</span>
        <span class="token keyword">case</span> <span class="token number">20</span><span class="token operator">:</span> <span class="token comment">// SEC_ERROR_UNTRUSTED_ISSUER, sec(20)</span>
        <span class="token keyword">case</span> <span class="token number">21</span><span class="token operator">:</span> <span class="token comment">// SEC_ERROR_UNTRUSTED_CERT, sec(21)</span>
        <span class="token keyword">case</span> <span class="token number">36</span><span class="token operator">:</span> <span class="token comment">// SEC_ERROR_CA_CERT_INVALID, sec(36)</span>
          errName <span class="token operator">=</span> <span class="token string">'SecurityUntrustedCertificateIssuerError'</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">90</span><span class="token operator">:</span> <span class="token comment">// SEC_ERROR_INADEQUATE_KEY_USAGE, sec(90)</span>
          errName <span class="token operator">=</span> <span class="token string">'SecurityInadequateKeyUsageError'</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">176</span><span class="token operator">:</span> <span class="token comment">// SEC_ERROR_CERT_SIGNATURE_ALGORITHM_DISABLED, sec(176)</span>
          errName <span class="token operator">=</span> <span class="token string">'SecurityCertificateSignatureAlgorithmDisabledError'</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
          errName <span class="token operator">=</span> <span class="token string">'SecurityError'</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// Calculating the difference</span>

  <span class="token keyword">let</span> sslErr <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>nsINSSErrorsService<span class="token punctuation">.</span><span class="token constant">NSS_SSL_ERROR_BASE</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>status <span class="token operator">&amp;</span> <span class="token number">0xffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">switch</span> <span class="token punctuation">(</span>sslErr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// SSL_ERROR_NO_CERTIFICATE, ssl(3)</span>
          errName <span class="token operator">=</span> <span class="token string">'SecurityNoCertificateError'</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token comment">// SSL_ERROR_BAD_CERTIFICATE, ssl(4)</span>
          errName <span class="token operator">=</span> <span class="token string">'SecurityBadCertificateError'</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span> <span class="token comment">// SSL_ERROR_UNSUPPORTED_CERTIFICATE_TYPE, ssl(8)</span>
          errName <span class="token operator">=</span> <span class="token string">'SecurityUnsupportedCertificateTypeError'</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">9</span><span class="token operator">:</span> <span class="token comment">// SSL_ERROR_UNSUPPORTED_VERSION, ssl(9)</span>
          errName <span class="token operator">=</span> <span class="token string">'SecurityUnsupportedTLSVersionError'</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">12</span><span class="token operator">:</span> <span class="token comment">// SSL_ERROR_BAD_CERT_DOMAIN, ssl(12)</span>
          errName <span class="token operator">=</span> <span class="token string">'SecurityCertificateDomainMismatchError'</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
          errName <span class="token operator">=</span> <span class="token string">'SecurityError'</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    errType <span class="token operator">=</span> <span class="token string">'Network'</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// connect to host:port failed</span>
      <span class="token keyword">case</span> <span class="token number">0x804B000C</span><span class="token operator">:</span> <span class="token comment">// NS_ERROR_CONNECTION_REFUSED, network(13)</span>
        errName <span class="token operator">=</span> <span class="token string">'ConnectionRefusedError'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token comment">// network timeout error</span>
      <span class="token keyword">case</span> <span class="token number">0x804B000E</span><span class="token operator">:</span> <span class="token comment">// NS_ERROR_NET_TIMEOUT, network(14)</span>
        errName <span class="token operator">=</span> <span class="token string">'NetworkTimeoutError'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token comment">// hostname lookup failed</span>
      <span class="token keyword">case</span> <span class="token number">0x804B001E</span><span class="token operator">:</span> <span class="token comment">// NS_ERROR_UNKNOWN_HOST, network(30)</span>
        errName <span class="token operator">=</span> <span class="token string">'DomainNotFoundError'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0x804B0047</span><span class="token operator">:</span> <span class="token comment">// NS_ERROR_NET_INTERRUPT, network(71)</span>
        errName <span class="token operator">=</span> <span class="token string">'NetworkInterruptError'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        errName <span class="token operator">=</span> <span class="token string">'NetworkError'</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// XXX we have no TCPError implementation right now because it's really hard to</span>
  <span class="token comment">// do on b2g18. On mozilla-central we want a proper TCPError that ideally</span>
  <span class="token comment">// sub-classes DOMError. Bug 867872 has been filed to implement this and</span>
  <span class="token comment">// contains a documented TCPError.webidl that maps all the error codes we use in</span>
  <span class="token comment">// this file to slightly more readable explanations.</span>
  <span class="token keyword">let</span> error <span class="token operator">=</span> Cc<span class="token punctuation">[</span><span class="token string">"@mozilla.org/dom-error;1"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">createInstance</span><span class="token punctuation">(</span>Ci<span class="token punctuation">.</span>nsIDOMDOMError<span class="token punctuation">)</span><span class="token punctuation">;</span>
  error<span class="token punctuation">.</span>wrappedJSObject<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>errName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> error<span class="token punctuation">;</span>

  <span class="token comment">// XXX: errType goes unused</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">dumpSecurityInfo</span><span class="token punctuation">(</span><span class="token parameter">xhr<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> channel <span class="token operator">=</span> xhr<span class="token punctuation">.</span>channel<span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"Connection status:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"\tsucceeded\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"\tfailed: "</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> secInfo <span class="token operator">=</span> channel<span class="token punctuation">.</span>securityInfo<span class="token punctuation">;</span>

    <span class="token comment">// Print general connection security state</span>
    <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"Security Information:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>secInfo <span class="token keyword">instanceof</span> <span class="token class-name">Ci<span class="token punctuation">.</span>nsITransportSecurityInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      secInfo<span class="token punctuation">.</span><span class="token function">QueryInterface</span><span class="token punctuation">(</span>Ci<span class="token punctuation">.</span>nsITransportSecurityInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"\tSecurity state of connection: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Check security state flags</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>secInfo<span class="token punctuation">.</span>securityState <span class="token operator">&amp;</span> Ci<span class="token punctuation">.</span>nsIWebProgressListener<span class="token punctuation">.</span><span class="token constant">STATE_IS_SECURE</span><span class="token punctuation">)</span>
           <span class="token operator">==</span> Ci<span class="token punctuation">.</span>nsIWebProgressListener<span class="token punctuation">.</span><span class="token constant">STATE_IS_SECURE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"secure connection\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>secInfo<span class="token punctuation">.</span>securityState <span class="token operator">&amp;</span> Ci<span class="token punctuation">.</span>nsIWebProgressListener<span class="token punctuation">.</span><span class="token constant">STATE_IS_INSECURE</span><span class="token punctuation">)</span>
                  <span class="token operator">==</span> Ci<span class="token punctuation">.</span>nsIWebProgressListener<span class="token punctuation">.</span><span class="token constant">STATE_IS_INSECURE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"insecure connection\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>secInfo<span class="token punctuation">.</span>securityState <span class="token operator">&amp;</span> Ci<span class="token punctuation">.</span>nsIWebProgressListener<span class="token punctuation">.</span><span class="token constant">STATE_IS_BROKEN</span><span class="token punctuation">)</span>
                  <span class="token operator">==</span> Ci<span class="token punctuation">.</span>nsIWebProgressListener<span class="token punctuation">.</span><span class="token constant">STATE_IS_BROKEN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"unknown\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"\tSecurity description: "</span> <span class="token operator">+</span> secInfo<span class="token punctuation">.</span>shortSecurityDescription <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"\tSecurity error message: "</span> <span class="token operator">+</span> secInfo<span class="token punctuation">.</span>errorMessage <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"\tNo security info available for this channel\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Print SSL certificate details</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>secInfo <span class="token keyword">instanceof</span> <span class="token class-name">Ci<span class="token punctuation">.</span>nsISSLStatusProvider</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> cert <span class="token operator">=</span> secInfo<span class="token punctuation">.</span><span class="token function">QueryInterface</span><span class="token punctuation">(</span>Ci<span class="token punctuation">.</span>nsISSLStatusProvider<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span>SSLStatus<span class="token punctuation">.</span><span class="token function">QueryInterface</span><span class="token punctuation">(</span>Ci<span class="token punctuation">.</span>nsISSLStatus<span class="token punctuation">)</span><span class="token punctuation">.</span>serverCert<span class="token punctuation">;</span>

      <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"\tCommon name (CN) = "</span> <span class="token operator">+</span> cert<span class="token punctuation">.</span>commonName <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"\tIssuer = "</span> <span class="token operator">+</span> cert<span class="token punctuation">.</span>issuerOrganization <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"\tOrganisation = "</span> <span class="token operator">+</span> cert<span class="token punctuation">.</span>organization <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"\tSHA1 fingerprint = "</span> <span class="token operator">+</span> cert<span class="token punctuation">.</span>sha1Fingerprint <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">var</span> validity <span class="token operator">=</span> cert<span class="token punctuation">.</span>validity<span class="token punctuation">.</span><span class="token function">QueryInterface</span><span class="token punctuation">(</span>Ci<span class="token punctuation">.</span>nsIX509CertValidity<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"\tValid from "</span> <span class="token operator">+</span> validity<span class="token punctuation">.</span>notBeforeGMT <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dump</span><span class="token punctuation">(</span><span class="token string">"\tValid until "</span> <span class="token operator">+</span> validity<span class="token punctuation">.</span>notAfterGMT <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> req <span class="token operator">=</span> Cc<span class="token punctuation">[</span><span class="token string">"@mozilla.org/xmlextras/xmlhttprequest;1"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">createInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> error <span class="token operator">=</span> <span class="token function">createTCPErrorFromFailedXHR</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dumpSecurityInfo</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  req<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">dumpSecurityInfo</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  req<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Then</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"https://addons.mozilla.org"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>produced the following output in my console:</p>
<pre class="notranslate">Connection status:
        succeeded
Security Info:
        Security state: secure
        Common name (CN) = addons.mozilla.org
        Organisation = Mozilla Corporation
        Issuer = VeriSign, Inc.
        SHA1 fingerprint = F4:99:64:18:6B:7D:C8:FA:C0:0C:2E:A9:61:77:28:67:13:C4:97:7B
        Valid from 7/14/2011 0:00:00 AM
        Valid until 8/20/2013 23:59:59 PM
</pre>
<p>And here is the output of making an HTTPS request to a server that uses an expired certificate:</p>
<div class="code-example"><pre class="brush: js notranslate"><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"https://www.appliancetherapy.com/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Note that the security state has become "insecure" now and there is an error name reported:</p>
<pre class="notranslate">Connection status:
        failed: SecurityExpiredCertificateError
Security Info:
        Security state: insecure
        Common name (CN) = www.appliancetherapy.com
        Organisation = Appliance Therapy Group (SELANE PRODUCTS, INC)
        Issuer = VeriSign, Inc.
        SHA1 fingerprint = F1:8C:38:96:0A:30:63:16:47:FA:6E:CD:7D:58:CC:AB:82:FB:A9:D0
        Valid from 9/1/2010 0:00:00 AM
        Valid until 9/1/2012 23:59:59 PM
</pre></div></article><aside class="metadata"><div class="metadata-content-container"><div id="on-github" class="on-github"><h3>Found a problem with this page?</h3><ul><li><a href="https://github.com/mdn/content/edit/main/files/en-us/web/api/xmlhttprequest/how_to_check_the_secruity_state_of_an_xmlhttprequest_over_ssl/index.md" title="You're going to need to sign in to GitHub first (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Edit on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/content/blob/main/files/en-us/web/api/xmlhttprequest/how_to_check_the_secruity_state_of_an_xmlhttprequest_over_ssl/index.md" title="Folder: en-us/web/api/xmlhttprequest/how_to_check_the_secruity_state_of_an_xmlhttprequest_over_ssl (Opens in a new tab)" target="_blank" rel="noopener noreferrer">Source on <b>GitHub</b></a></li><li><a href="https://github.com/mdn/content/issues/new?body=MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FXMLHttpRequest%2FHow_to_check_the_secruity_state_of_an_XMLHTTPRequest_over_SSL%0A%0A%23%23%23%23+What+information+was+incorrect%2C+unhelpful%2C+or+incomplete%3F%0A%0A%0A%23%23%23%23+Specific+section+or+headline%3F%0A%0A%0A%23%23%23%23+What+did+you+expect+to+see%3F%0A%0A%0A%23%23%23%23+Did+you+test+this%3F+If+so%2C+how%3F%0A%0A%0A%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EMDN+Content+page+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60en-us%2Fweb%2Fapi%2Fxmlhttprequest%2Fhow_to_check_the_secruity_state_of_an_xmlhttprequest_over_ssl%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FXMLHttpRequest%2FHow_to_check_the_secruity_state_of_an_XMLHTTPRequest_over_SSL%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fmain%2Ffiles%2Fen-us%2Fweb%2Fapi%2Fxmlhttprequest%2Fhow_to_check_the_secruity_state_of_an_xmlhttprequest_over_ssl%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2F473efa32fe17feb192ef6ec3a15ca4f767006051%0A*+Document+last+modified%3A+2022-01-24T11%3A26%3A15.000Z%0A%0A%3C%2Fdetails%3E&amp;title=Issue+with+%22How+to+check+the+security+state+of+an+XMLHTTPReque%E2%80%A6%22%3A+%28short+summary+here+please%29&amp;labels=needs-triage%2CContent%3AWebAPI" title="This will take you to https://github.com/mdn/content to file a new issue" target="_blank" rel="noopener noreferrer">Report a problem with this content on <b>GitHub</b></a></li><li>Want to fix the problem yourself? See<!-- --> <a href="https://github.com/mdn/content/blob/main/README.md" target="_blank" rel="noopener noreferrer">our Contribution guide</a>.</li></ul></div><p class="last-modified-date"><b>Last modified:</b> <time datetime="2022-01-24T11:26:15.000Z">Jan 24, 2022</time>,<!-- --> <a href="How_to_check_the_secruity_state_of_an_XMLHTTPRequest_over_SSL/contributors.txt">by MDN contributors</a></p></div></aside><footer id="nav-footer" class="page-footer"><div><a href="http://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/How_to_check_the_secruity_state_of_an_XMLHTTPRequest_over_SSL">How to check the security state of an XMLHTTPRequest over SSL</a> by <a href="http://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/How_to_check_the_secruity_state_of_an_XMLHTTPRequest_over_SSL$history">Mozilla Contributors</a> is licensed under <a href="http://creativecommons.org/licenses/by-sa/2.5/">CC-BY-SA 2.5</a>.</div></footer></main></div><div class="page-overlay hidden"></div></div><script type="application/json" id="hydration">{"doc":{"isMarkdown":true,"isTranslated":false,"isActive":true,"flaws":{},"title":"How to check the security state of an XMLHTTPRequest over SSL","mdn_url":"/en-US/docs/Web/API/XMLHttpRequest/How_to_check_the_secruity_state_of_an_XMLHTTPRequest_over_SSL","locale":"en-US","native":"English (US)","sidebarHTML":"","body":[{"type":"prose","value":{"id":null,"title":null,"isH3":false,"content":"<p>Here is a an example Javascript function that prints the security details of an <a href=\"/en-US/docs/Web/API/XMLHttpRequest\">XMLHTTPRequest</a> sent over SSL. The function is passed the channel property of an XMLHTTPRequest to extract the following information:</p>\n<ul>\n  <li>Was the connection secure?</li>\n  <li>Was the used SSL certificate valid and what are its details (owner, expiration, certificate authority, etc.)?</li>\n</ul>\n<p>Notes:</p>\n<ol>\n  <li>This code requires elevated privileges to run; you can only call it from a browser extension or from a XULRunner application.</li>\n  <li>The channel property becomes available only after the request is sent and the connection was established, that is, on readyState <code>LOADED</code>, <code>INTERACTIVE</code> or <code>COMPLETED</code>.</li>\n  <li>By setting the mozBackgroundRequest property of the request object and modifying the example appropriately, you can create your own alert dialog to handle SSL exceptions in your Firefox extension or XULRunner application.</li>\n</ol>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token comment\">// Adapted from the patch for mozTCPSocket error reporting (bug 861196).</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>Cc<span class=\"token punctuation\">,</span>Ci<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"chrome\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">createTCPErrorFromFailedXHR</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">xhr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> status <span class=\"token operator\">=</span> xhr<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">.</span><span class=\"token function\">QueryInterface</span><span class=\"token punctuation\">(</span>Ci<span class=\"token punctuation\">.</span>nsIRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> errType<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>status <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xff0000</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">0x5a0000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// Security module</span>\n    <span class=\"token keyword\">const</span> nsINSSErrorsService <span class=\"token operator\">=</span> Ci<span class=\"token punctuation\">.</span>nsINSSErrorsService<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> nssErrorsService <span class=\"token operator\">=</span> Cc<span class=\"token punctuation\">[</span><span class=\"token string\">'@mozilla.org/nss_errors_service;1'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">getService</span><span class=\"token punctuation\">(</span>nsINSSErrorsService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> errorClass<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// getErrorClass will throw a generic NS_ERROR_FAILURE if the error code is</span>\n    <span class=\"token comment\">// somehow not in the set of covered errors.</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      errorClass <span class=\"token operator\">=</span> nssErrorsService<span class=\"token punctuation\">.</span><span class=\"token function\">getErrorClass</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//catching security protocol exception</span>\n      errorClass <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityProtocol'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>errorClass <span class=\"token operator\">==</span> nsINSSErrorsService<span class=\"token punctuation\">.</span><span class=\"token constant\">ERROR_CLASS_BAD_CERT</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      errType <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityCertificate'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      errType <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityProtocol'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// NSS_SEC errors (happen below the base value because of negative vals)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>status <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>nsINSSErrorsService<span class=\"token punctuation\">.</span><span class=\"token constant\">NSS_SEC_ERROR_BASE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// The bases are actually negative, so in our positive numeric space, we</span>\n      <span class=\"token comment\">// need to subtract the base off our value.</span>\n      <span class=\"token keyword\">let</span> nssErr <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>nsINSSErrorsService<span class=\"token punctuation\">.</span><span class=\"token constant\">NSS_SEC_ERROR_BASE</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>status <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>nssErr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">11</span><span class=\"token operator\">:</span> <span class=\"token comment\">// SEC_ERROR_EXPIRED_CERTIFICATE, sec(11)</span>\n          errName <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityExpiredCertificateError'</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">12</span><span class=\"token operator\">:</span> <span class=\"token comment\">// SEC_ERROR_REVOKED_CERTIFICATE, sec(12)</span>\n          errName <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityRevokedCertificateError'</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// per bsmith, we will be unable to tell these errors apart very soon,</span>\n        <span class=\"token comment\">// so it makes sense to just folder them all together already.</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">13</span><span class=\"token operator\">:</span> <span class=\"token comment\">// SEC_ERROR_UNKNOWN_ISSUER, sec(13)</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">20</span><span class=\"token operator\">:</span> <span class=\"token comment\">// SEC_ERROR_UNTRUSTED_ISSUER, sec(20)</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">21</span><span class=\"token operator\">:</span> <span class=\"token comment\">// SEC_ERROR_UNTRUSTED_CERT, sec(21)</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">36</span><span class=\"token operator\">:</span> <span class=\"token comment\">// SEC_ERROR_CA_CERT_INVALID, sec(36)</span>\n          errName <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityUntrustedCertificateIssuerError'</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">90</span><span class=\"token operator\">:</span> <span class=\"token comment\">// SEC_ERROR_INADEQUATE_KEY_USAGE, sec(90)</span>\n          errName <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityInadequateKeyUsageError'</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">176</span><span class=\"token operator\">:</span> <span class=\"token comment\">// SEC_ERROR_CERT_SIGNATURE_ALGORITHM_DISABLED, sec(176)</span>\n          errName <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityCertificateSignatureAlgorithmDisabledError'</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n          errName <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityError'</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Calculating the difference</span>\n\n  <span class=\"token keyword\">let</span> sslErr <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>nsINSSErrorsService<span class=\"token punctuation\">.</span><span class=\"token constant\">NSS_SSL_ERROR_BASE</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>status <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xffff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>sslErr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span> <span class=\"token comment\">// SSL_ERROR_NO_CERTIFICATE, ssl(3)</span>\n          errName <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityNoCertificateError'</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">4</span><span class=\"token operator\">:</span> <span class=\"token comment\">// SSL_ERROR_BAD_CERTIFICATE, ssl(4)</span>\n          errName <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityBadCertificateError'</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">8</span><span class=\"token operator\">:</span> <span class=\"token comment\">// SSL_ERROR_UNSUPPORTED_CERTIFICATE_TYPE, ssl(8)</span>\n          errName <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityUnsupportedCertificateTypeError'</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">9</span><span class=\"token operator\">:</span> <span class=\"token comment\">// SSL_ERROR_UNSUPPORTED_VERSION, ssl(9)</span>\n          errName <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityUnsupportedTLSVersionError'</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">12</span><span class=\"token operator\">:</span> <span class=\"token comment\">// SSL_ERROR_BAD_CERT_DOMAIN, ssl(12)</span>\n          errName <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityCertificateDomainMismatchError'</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n          errName <span class=\"token operator\">=</span> <span class=\"token string\">'SecurityError'</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    errType <span class=\"token operator\">=</span> <span class=\"token string\">'Network'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// connect to host:port failed</span>\n      <span class=\"token keyword\">case</span> <span class=\"token number\">0x804B000C</span><span class=\"token operator\">:</span> <span class=\"token comment\">// NS_ERROR_CONNECTION_REFUSED, network(13)</span>\n        errName <span class=\"token operator\">=</span> <span class=\"token string\">'ConnectionRefusedError'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// network timeout error</span>\n      <span class=\"token keyword\">case</span> <span class=\"token number\">0x804B000E</span><span class=\"token operator\">:</span> <span class=\"token comment\">// NS_ERROR_NET_TIMEOUT, network(14)</span>\n        errName <span class=\"token operator\">=</span> <span class=\"token string\">'NetworkTimeoutError'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// hostname lookup failed</span>\n      <span class=\"token keyword\">case</span> <span class=\"token number\">0x804B001E</span><span class=\"token operator\">:</span> <span class=\"token comment\">// NS_ERROR_UNKNOWN_HOST, network(30)</span>\n        errName <span class=\"token operator\">=</span> <span class=\"token string\">'DomainNotFoundError'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> <span class=\"token number\">0x804B0047</span><span class=\"token operator\">:</span> <span class=\"token comment\">// NS_ERROR_NET_INTERRUPT, network(71)</span>\n        errName <span class=\"token operator\">=</span> <span class=\"token string\">'NetworkInterruptError'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n        errName <span class=\"token operator\">=</span> <span class=\"token string\">'NetworkError'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// XXX we have no TCPError implementation right now because it's really hard to</span>\n  <span class=\"token comment\">// do on b2g18. On mozilla-central we want a proper TCPError that ideally</span>\n  <span class=\"token comment\">// sub-classes DOMError. Bug 867872 has been filed to implement this and</span>\n  <span class=\"token comment\">// contains a documented TCPError.webidl that maps all the error codes we use in</span>\n  <span class=\"token comment\">// this file to slightly more readable explanations.</span>\n  <span class=\"token keyword\">let</span> error <span class=\"token operator\">=</span> Cc<span class=\"token punctuation\">[</span><span class=\"token string\">\"@mozilla.org/dom-error;1\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">createInstance</span><span class=\"token punctuation\">(</span>Ci<span class=\"token punctuation\">.</span>nsIDOMDOMError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  error<span class=\"token punctuation\">.</span>wrappedJSObject<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span>errName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> error<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// XXX: errType goes unused</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">dumpSecurityInfo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">xhr<span class=\"token punctuation\">,</span> error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> channel <span class=\"token operator\">=</span> xhr<span class=\"token punctuation\">.</span>channel<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Connection status:\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tsucceeded\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tfailed: \"</span> <span class=\"token operator\">+</span> error<span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">let</span> secInfo <span class=\"token operator\">=</span> channel<span class=\"token punctuation\">.</span>securityInfo<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Print general connection security state</span>\n    <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Security Information:\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>secInfo <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Ci<span class=\"token punctuation\">.</span>nsITransportSecurityInfo</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      secInfo<span class=\"token punctuation\">.</span><span class=\"token function\">QueryInterface</span><span class=\"token punctuation\">(</span>Ci<span class=\"token punctuation\">.</span>nsITransportSecurityInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tSecurity state of connection: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// Check security state flags</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>secInfo<span class=\"token punctuation\">.</span>securityState <span class=\"token operator\">&amp;</span> Ci<span class=\"token punctuation\">.</span>nsIWebProgressListener<span class=\"token punctuation\">.</span><span class=\"token constant\">STATE_IS_SECURE</span><span class=\"token punctuation\">)</span>\n           <span class=\"token operator\">==</span> Ci<span class=\"token punctuation\">.</span>nsIWebProgressListener<span class=\"token punctuation\">.</span><span class=\"token constant\">STATE_IS_SECURE</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"secure connection\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>secInfo<span class=\"token punctuation\">.</span>securityState <span class=\"token operator\">&amp;</span> Ci<span class=\"token punctuation\">.</span>nsIWebProgressListener<span class=\"token punctuation\">.</span><span class=\"token constant\">STATE_IS_INSECURE</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token operator\">==</span> Ci<span class=\"token punctuation\">.</span>nsIWebProgressListener<span class=\"token punctuation\">.</span><span class=\"token constant\">STATE_IS_INSECURE</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"insecure connection\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>secInfo<span class=\"token punctuation\">.</span>securityState <span class=\"token operator\">&amp;</span> Ci<span class=\"token punctuation\">.</span>nsIWebProgressListener<span class=\"token punctuation\">.</span><span class=\"token constant\">STATE_IS_BROKEN</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token operator\">==</span> Ci<span class=\"token punctuation\">.</span>nsIWebProgressListener<span class=\"token punctuation\">.</span><span class=\"token constant\">STATE_IS_BROKEN</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unknown\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tSecurity description: \"</span> <span class=\"token operator\">+</span> secInfo<span class=\"token punctuation\">.</span>shortSecurityDescription <span class=\"token operator\">+</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tSecurity error message: \"</span> <span class=\"token operator\">+</span> secInfo<span class=\"token punctuation\">.</span>errorMessage <span class=\"token operator\">+</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tNo security info available for this channel\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Print SSL certificate details</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>secInfo <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Ci<span class=\"token punctuation\">.</span>nsISSLStatusProvider</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> cert <span class=\"token operator\">=</span> secInfo<span class=\"token punctuation\">.</span><span class=\"token function\">QueryInterface</span><span class=\"token punctuation\">(</span>Ci<span class=\"token punctuation\">.</span>nsISSLStatusProvider<span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span>SSLStatus<span class=\"token punctuation\">.</span><span class=\"token function\">QueryInterface</span><span class=\"token punctuation\">(</span>Ci<span class=\"token punctuation\">.</span>nsISSLStatus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>serverCert<span class=\"token punctuation\">;</span>\n\n      <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tCommon name (CN) = \"</span> <span class=\"token operator\">+</span> cert<span class=\"token punctuation\">.</span>commonName <span class=\"token operator\">+</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tIssuer = \"</span> <span class=\"token operator\">+</span> cert<span class=\"token punctuation\">.</span>issuerOrganization <span class=\"token operator\">+</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tOrganisation = \"</span> <span class=\"token operator\">+</span> cert<span class=\"token punctuation\">.</span>organization <span class=\"token operator\">+</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tSHA1 fingerprint = \"</span> <span class=\"token operator\">+</span> cert<span class=\"token punctuation\">.</span>sha1Fingerprint <span class=\"token operator\">+</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">var</span> validity <span class=\"token operator\">=</span> cert<span class=\"token punctuation\">.</span>validity<span class=\"token punctuation\">.</span><span class=\"token function\">QueryInterface</span><span class=\"token punctuation\">(</span>Ci<span class=\"token punctuation\">.</span>nsIX509CertValidity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tValid from \"</span> <span class=\"token operator\">+</span> validity<span class=\"token punctuation\">.</span>notBeforeGMT <span class=\"token operator\">+</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tValid until \"</span> <span class=\"token operator\">+</span> validity<span class=\"token punctuation\">.</span>notAfterGMT <span class=\"token operator\">+</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> req <span class=\"token operator\">=</span> Cc<span class=\"token punctuation\">[</span><span class=\"token string\">\"@mozilla.org/xmlextras/xmlhttprequest;1\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">createInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  req<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  req<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> error <span class=\"token operator\">=</span> <span class=\"token function\">createTCPErrorFromFailedXHR</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">dumpSecurityInfo</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  req<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">dumpSecurityInfo</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  req<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Then</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://addons.mozilla.org\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>produced the following output in my console:</p>\n<pre class=\"notranslate\">Connection status:\n        succeeded\nSecurity Info:\n        Security state: secure\n        Common name (CN) = addons.mozilla.org\n        Organisation = Mozilla Corporation\n        Issuer = VeriSign, Inc.\n        SHA1 fingerprint = F4:99:64:18:6B:7D:C8:FA:C0:0C:2E:A9:61:77:28:67:13:C4:97:7B\n        Valid from 7/14/2011 0:00:00 AM\n        Valid until 8/20/2013 23:59:59 PM\n</pre>\n<p>And here is the output of making an HTTPS request to a server that uses an expired certificate:</p>\n<div class=\"code-example\"><pre class=\"brush: js notranslate\"><code><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://www.appliancetherapy.com/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Note that the security state has become \"insecure\" now and there is an error name reported:</p>\n<pre class=\"notranslate\">Connection status:\n        failed: SecurityExpiredCertificateError\nSecurity Info:\n        Security state: insecure\n        Common name (CN) = www.appliancetherapy.com\n        Organisation = Appliance Therapy Group (SELANE PRODUCTS, INC)\n        Issuer = VeriSign, Inc.\n        SHA1 fingerprint = F1:8C:38:96:0A:30:63:16:47:FA:6E:CD:7D:58:CC:AB:82:FB:A9:D0\n        Valid from 9/1/2010 0:00:00 AM\n        Valid until 9/1/2012 23:59:59 PM\n</pre>"}}],"toc":[],"summary":"Here is a an example Javascript function that prints the security details of an XMLHTTPRequest sent over SSL. The function is passed the channel property of an XMLHTTPRequest to extract the following information:","popularity":0,"modified":"2022-01-24T11:26:15.000Z","source":{"folder":"en-us/web/api/xmlhttprequest/how_to_check_the_secruity_state_of_an_xmlhttprequest_over_ssl","github_url":"https://github.com/mdn/content/blob/main/files/en-us/web/api/xmlhttprequest/how_to_check_the_secruity_state_of_an_xmlhttprequest_over_ssl/index.md","last_commit_url":"https://github.com/mdn/content/commit/473efa32fe17feb192ef6ec3a15ca4f767006051","filename":"index.md"},"parents":[{"uri":"/en-US/docs/Web","title":"Web technology for developers"},{"uri":"/en-US/docs/Web/API","title":"Web APIs"},{"uri":"/en-US/docs/Web/API/XMLHttpRequest","title":"XMLHttpRequest"},{"uri":"/en-US/docs/Web/API/XMLHttpRequest/How_to_check_the_secruity_state_of_an_XMLHTTPRequest_over_SSL","title":"How to check the security state of an XMLHTTPRequest over SSL"}],"pageTitle":"How to check the security state of an XMLHTTPRequest over SSL - Web APIs | MDN","noIndexing":false}}</script>
<!-- Mirrored from developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/How_to_check_the_secruity_state_of_an_XMLHTTPRequest_over_SSL by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 31 Jan 2022 17:49:52 GMT -->
</body></html>